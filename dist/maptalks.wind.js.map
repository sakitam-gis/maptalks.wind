{"version":3,"file":"maptalks.wind.js","sources":["../src/core/utils.ts","../src/core/index.ts","../src/render/renderer.ts","../src/index.ts"],"sourcesContent":["function createShader(gl: WebGLRenderingContext, type: number, source: string): WebGLShader {\n  const shader: WebGLShader | null = gl.createShader(type) || {};\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(gl.getShaderInfoLog(shader) || '');\n  }\n  return shader;\n}\n\nfunction createProgram(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string): object {\n  const program: WebGLProgram = gl.createProgram() || '';\n  const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(gl.getProgramInfoLog(program) || '');\n  }\n  const wrapper: any = {\n    program,\n  };\n  const numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  // tslint:disable-next-line:no-increment-decrement\n  for (let i = 0; i < numAttributes; i++) {\n    // @ts-ignore\n    const attribute: WebGLActiveInfo = gl.getActiveAttrib(program, i);\n    wrapper[attribute.name] = gl.getAttribLocation(program, attribute.name);\n  }\n  const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  // tslint:disable-next-line:no-increment-decrement\n  for (let i = 0; i < numUniforms; i++) {\n    // @ts-ignore\n    const uniform: WebGLActiveInfo = gl.getActiveUniform(program, i);\n    wrapper[uniform.name] = gl.getUniformLocation(program, uniform.name);\n  }\n  return wrapper;\n}\n\nfunction createTexture(\n  gl: WebGLRenderingContext,\n  filter: GLint,\n  data: Uint8Array,\n  width?: number,\n  height?: number,\n): WebGLTexture | null {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n  if (data instanceof Uint8Array) {\n    // @ts-ignore\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  }\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return texture;\n}\n\nfunction bindTexture(gl: WebGLRenderingContext, texture: WebGLTexture|null, unit: number) {\n  gl.activeTexture(gl.TEXTURE0 + unit);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n}\n\nfunction createBuffer(gl: WebGLRenderingContext, data: Float32Array): WebGLBuffer|null {\n  const buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  return buffer;\n}\n\nfunction bindAttribute(gl: WebGLRenderingContext, buffer: WebGLBuffer|null, attribute: GLuint, numComponents: GLint) {\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.enableVertexAttribArray(attribute);\n  gl.vertexAttribPointer(attribute, numComponents, gl.FLOAT, false, 0, 0);\n}\n\nfunction bindFramebuffer(gl: WebGLRenderingContext, framebuffer: WebGLBuffer|null, texture?: WebGLTexture|null) {\n  // 创建一个帧缓冲\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  if (texture) {\n    // 绑定纹理到帧缓冲\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  }\n}\n\n/**\n * get gl context\n * @param canvas\n * @param glOptions\n * @returns {null}\n */\nexport function getGlContext(canvas: HTMLCanvasElement, glOptions = {}) {\n  const names = ['webgl', 'experimental-webgl'];\n  let context: WebGLRenderingContext | null = null;\n\n  function onContextCreationError(error: any) {\n    console.error(error.statusMessage);\n  }\n\n  canvas.addEventListener(\n    'webglcontextcreationerror',\n    onContextCreationError,\n    false,\n  );\n  for (let ii = 0; ii < names.length; ++ii) {\n    try {\n      context = canvas.getContext(\n        names[ii],\n        glOptions,\n      ) as WebGLRenderingContext;\n    } catch (e) {} // eslint-disable-line\n    if (context) {\n      break;\n    }\n  }\n\n  canvas.removeEventListener(\n    'webglcontextcreationerror',\n    onContextCreationError,\n    false,\n  );\n\n  if (!context || !context.getExtension('OES_texture_float')) {\n    return null;\n  }\n  return context;\n}\n\n/**\n * clear scene\n * @param gl\n * @param color\n */\nexport function clearScene(gl: WebGLRenderingContext, color: number[]) {\n  const [r, g, b, a] = color;\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n  gl.clearColor(r, g, b, a);\n  gl.clearDepth(1);\n  // tslint:disable-next-line:no-bitwise\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  gl.enable(gl.DEPTH_TEST);\n}\n\nexport {\n  createBuffer,\n  createProgram,\n  bindAttribute,\n  bindFramebuffer,\n  bindTexture,\n  createTexture,\n};\n","// from https://github.com/mapbox/webgl-wind/blob/c1fa1316f7/src/index.js\nimport {\n  bindTexture,\n  createBuffer,\n  createTexture,\n  createProgram,\n  bindAttribute,\n  bindFramebuffer,\n} from './utils';\nimport drawVert from '../shaders/draw.vertex.glsl';\nimport drawFrag from '../shaders/draw.fragment.glsl';\n\nimport screenVert from '../shaders/screen.vertex.glsl';\nimport screenFrag from '../shaders/screen.fragment.glsl';\n\nimport updateVert from '../shaders/update.vertex.glsl';\nimport updateFrag from '../shaders/update.fragment.glsl';\n\n// const NO_TRANSFORM = {dx: 0, dy: 0, scale: 1};\n\nfunction getColorRamp(colors: any) {\n  const canvas = document.createElement('canvas');\n  const ctx: any = canvas.getContext('2d');\n  canvas.width = 256;\n  canvas.height = 1;\n  const gradient = ctx.createLinearGradient(0, 0, 256, 0);\n  Object.keys(colors).forEach((stop: number | string) => {\n    gradient.addColorStop(+stop, colors[stop]);\n  });\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, 256, 1);\n  return new Uint8Array(ctx.getImageData(0, 0, 256, 1).data);\n}\n\nconst defaultRampColors = {\n  0.0: '#3288bd',\n  0.1: '#66c2a5',\n  0.2: '#abdda4',\n  0.3: '#e6f598',\n  0.4: '#fee08b',\n  0.5: '#fdae61',\n  0.6: '#f46d43',\n  1.0: '#d53e4f',\n};\n\n// tslint:disable-next-line:class-name\ninterface optionsTypes {\n  fadeOpacity?: number;\n  speedFactor?: number;\n  dropRate?: number;\n  dropRateBump?: number;\n  colorRamp?: {};\n  numParticles?: number;\n}\n\nclass WindGL {\n\n  set numParticles(numParticles) {\n    const gl = this.gl;\n    // we create a square texture where each pixel will hold a particle position encoded as RGBA\n    const particleRes = Math.ceil(Math.sqrt(numParticles));\n    this.particleStateResolution = particleRes;\n    this._numParticles = particleRes * particleRes;\n\n    const particleState = new Uint8Array(this._numParticles * 4);\n    // tslint:disable-next-line:no-increment-decrement\n    for (let i = 0; i < particleState.length; i++) {\n      // randomize the initial particle positions\n      particleState[i] = Math.floor(Math.random() * 256);\n    }\n    // textures to hold the particle state for the current and the next frame\n    this.particleStateTexture0 = createTexture(\n      gl, gl.NEAREST, particleState, particleRes, particleRes,\n    );\n    this.particleStateTexture1 = createTexture(\n      gl, gl.NEAREST, particleState, particleRes, particleRes,\n    );\n    const particleIndices = new Float32Array(this._numParticles);\n    // tslint:disable-next-line:no-increment-decrement\n    for (let i = 0; i < this._numParticles; i++) { particleIndices[i] = i; }\n    this.particleIndexBuffer = createBuffer(gl, particleIndices);\n  }\n\n  get numParticles() {\n    return this._numParticles;\n  }\n  public matrix: any;\n  public gl: WebGLRenderingContext;\n  public fadeOpacity: number;\n  public speedFactor: number;\n  public dropRate: number;\n  public dropRateBump: number;\n  public windData: {\n    source: string;\n    date: Date;\n    width: number;\n    height: number;\n    uMin: number;\n    uMax: number;\n    vMin: number;\n    vMax: number;\n  };\n  public _numParticles: number;\n  public options: optionsTypes;\n  private drawProgram: any;\n  private screenProgram: any;\n  private updateProgram: any;\n  private quadBuffer: WebGLBuffer|null;\n  public framebuffer: WebGLFramebuffer|null;\n\n  private screenTexture: WebGLTexture|null;\n  private colorRampTexture: WebGLTexture|null;\n  private backgroundTexture: WebGLTexture|null;\n  private particleStateResolution: number;\n  private particleIndexBuffer: WebGLBuffer|null;\n  private particleStateTexture1: WebGLTexture|null;\n  private particleStateTexture0: WebGLTexture|null;\n\n  private windTexture: WebGLTexture|null;\n  constructor(gl: WebGLRenderingContext, options: optionsTypes) {\n    const { fadeOpacity, speedFactor, dropRate, dropRateBump, colorRamp, numParticles } = options;\n    this.options = options;\n    this.gl = gl;\n    this.fadeOpacity = fadeOpacity || 0.895; // how fast the particle trails fade on each frame\n    this.speedFactor = speedFactor || 0.25; // how fast the particles move\n    this.dropRate = dropRate || 0.003; // how often the particles move to a random place\n    // drop rate increase relative to individual particle speed\n    this.dropRateBump = dropRateBump || 0.01;\n    // this.numParticles = numParticles || 65536;\n\n    this.drawProgram = createProgram(gl, drawVert, drawFrag);\n    this.screenProgram = createProgram(gl, screenVert, screenFrag);\n    this.updateProgram = createProgram(gl, updateVert, updateFrag);\n\n    this.quadBuffer = createBuffer(gl, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]));\n    this.framebuffer = gl.createFramebuffer();\n    // @ts-ignore\n    this.windData = {};\n\n    this.backgroundTexture = null;\n    this.screenTexture = null;\n    this.colorRampTexture = null;\n    this.particleStateResolution = Infinity;\n    this._numParticles = Infinity;\n\n    this.particleIndexBuffer = null;\n    this.particleStateTexture0 = null;\n    this.particleStateTexture1 = null;\n\n    this.windTexture = null;\n\n    this.matrix = [];\n\n    this.setColorRamp(colorRamp || defaultRampColors);\n    this.numParticles = numParticles || 65536;\n    this.resize();\n  }\n\n  setOptions(options: optionsTypes) {\n    const { fadeOpacity, speedFactor, dropRate, dropRateBump, colorRamp, numParticles } = options;\n    this.fadeOpacity = fadeOpacity || 0.996; // how fast the particle trails fade on each frame\n    this.speedFactor = speedFactor || 0.25; // how fast the particles move\n    this.dropRate = dropRate || 0.003; // how often the particles move to a random place\n    // drop rate increase relative to individual particle speed\n    this.dropRateBump = dropRateBump || 0.01;\n    this.setColorRamp(colorRamp || defaultRampColors);\n    this.numParticles = numParticles || 65536;\n  }\n\n  resize() {\n    const gl = this.gl;\n    const emptyPixels = new Uint8Array(gl.canvas.width * gl.canvas.height * 4);\n    // screen textures to hold the drawn screen for the previous and the current frame\n    this.backgroundTexture = createTexture(\n      gl, gl.NEAREST, emptyPixels, gl.canvas.width, gl.canvas.height,\n    );\n    this.screenTexture = createTexture(\n      gl, gl.NEAREST, emptyPixels, gl.canvas.width, gl.canvas.height,\n    );\n  }\n\n  setColorRamp(colors: object) {\n    // lookup texture for colorizing the particles according to their speed\n    this.colorRampTexture = createTexture(\n      this.gl, this.gl.LINEAR, getColorRamp(colors), 16, 16,\n    );\n  }\n\n  setWind(data: {\n    source: string;\n    date: Date;\n    width: number;\n    height: number;\n    uMin: number;\n    uMax: number;\n    vMin: number;\n    vMax: number;\n  },      image: any) {\n    this.windData = data;\n    this.windTexture = createTexture(this.gl, this.gl.LINEAR, image);\n  }\n\n  render(matrix: number[], dateLineOffset: number, params: any) {\n    const gl = this.gl;\n    const windData = this.windData;\n    if (!gl || !windData) { return; }\n    this.matrix = matrix;\n    const blendingEnabled = gl.isEnabled(gl.BLEND);\n    gl.disable(gl.BLEND);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.STENCIL_TEST);\n    bindTexture(gl, this.windTexture, 0);\n    bindTexture(gl, this.particleStateTexture0, 1);\n    this.drawScreen(matrix, dateLineOffset, params);\n    this.updateParticles();\n    if (blendingEnabled) { gl.enable(gl.BLEND); }\n  }\n\n  // @ts-ignore\n  drawScreen(matrix: number[], dateLineOffset: number, params: any) {\n    const gl = this.gl;\n    // draw the screen into a temporary framebuffer to retain it as the background on the next frame\n    bindFramebuffer(gl, this.framebuffer, this.screenTexture);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n    this.drawTexture(this.backgroundTexture, this.fadeOpacity);\n    this.drawParticles(matrix, dateLineOffset, params);\n\n    bindFramebuffer(gl, null);\n\n    gl.enable(gl.BLEND);\n\n    // 非预乘阿尔法\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    gl.clearColor(0.0, 0.0, 0.0, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    // 预乘阿尔法通道\n    // gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    this.drawTexture(this.screenTexture, 1.0);\n    // this.drawParticles(matrix, dateLineOffset);\n\n    gl.disable(gl.BLEND);\n    // save the current screen as the background for the next frame\n    const temp = this.backgroundTexture;\n    this.backgroundTexture = this.screenTexture;\n    this.screenTexture = temp;\n  }\n\n  drawTexture(texture: WebGLTexture | null, opacity: number) {\n    const gl = this.gl;\n    const program = this.screenProgram;\n    gl.useProgram(program.program);\n    bindAttribute(gl, this.quadBuffer, program.a_pos, 2);\n    bindTexture(gl, texture, 2);\n\n    gl.uniform1i(program.u_screen, 2);\n    gl.uniform1f(program.u_opacity_border, 0.0);\n    gl.uniform1f(program.u_opacity, opacity);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  drawParticles(matrix: number[], dateLineOffset: number, params: any) {\n    const gl = this.gl;\n    const program = this.drawProgram;\n    gl.useProgram(program.program);\n\n    bindAttribute(gl, this.particleIndexBuffer, program.a_index, 1);\n    bindTexture(gl, this.colorRampTexture, 2);\n\n    gl.uniform1i(program.u_wind, 0);\n    gl.uniform1i(program.u_particles, 1);\n    gl.uniform1i(program.u_color_ramp, 2);\n    gl.uniform1f(program.u_particles_res, this.particleStateResolution);\n    gl.uniform2f(program.u_wind_min, this.windData.uMin, this.windData.vMin);\n    gl.uniform2f(program.u_wind_max, this.windData.uMax, this.windData.vMax);\n    gl.uniform1f(program.u_dateline_offset, dateLineOffset);\n\n    gl.uniform1f(program.transformScale, params.transformScale);\n    gl.uniform2fv(program.projectionExtent, [params.projectionExtent[2], params.projectionExtent[3]]);\n    gl.uniform4fv(program.transformMatrix, params.transformMatrix);\n\n    // 1、要修改的uniform属性的位置的对象 2、是否逆转矩阵 3、矩阵\n    gl.uniformMatrix4fv(program.u_matrix, false, matrix);\n    gl.drawArrays(gl.POINTS, 0, this._numParticles);\n  }\n\n  updateParticles() {\n    const gl = this.gl;\n    bindFramebuffer(gl, this.framebuffer, this.particleStateTexture1);\n    gl.viewport(0, 0, this.particleStateResolution, this.particleStateResolution);\n    const program = this.updateProgram;\n    gl.useProgram(program.program);\n\n    bindAttribute(gl, this.quadBuffer, program.a_pos, 2);\n\n    gl.uniform1i(program.u_wind, 0);\n    gl.uniform1i(program.u_particles, 1);\n    gl.uniform1f(program.u_rand_seed, Math.random());\n    gl.uniform2f(program.u_wind_res, this.windData.width, this.windData.height);\n    gl.uniform2f(program.u_wind_min, this.windData.uMin, this.windData.vMin);\n    gl.uniform2f(program.u_wind_max, this.windData.uMax, this.windData.vMax);\n    gl.uniform1f(program.u_speed_factor, this.speedFactor);\n    gl.uniform1f(program.u_drop_rate, this.dropRate);\n    gl.uniform1f(program.u_drop_rate_bump, this.dropRateBump);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    // swap the particle state textures so the new one becomes the current one\n    const temp = this.particleStateTexture0;\n    this.particleStateTexture0 = this.particleStateTexture1;\n    this.particleStateTexture1 = temp;\n  }\n}\n\nexport default WindGL;\n","import * as maptalks from 'maptalks';\nimport { getGlContext } from '../core/utils';\n\nclass Renderer extends maptalks.renderer.CanvasLayerRenderer {\n  public canvas: HTMLCanvasElement | undefined;\n  public canvas2: HTMLCanvasElement | undefined;\n  public layer: any;\n  public gl: WebGLRenderingContext | undefined | null;\n  private _drawContext: CanvasRenderingContext2D | undefined;\n\n  public checkResources() {\n    return [];\n  }\n\n  public getDrawParams() {\n    return [];\n  }\n\n  public hitDetect() {\n    return false;\n  }\n\n  public draw() {\n    this.prepareCanvas();\n    this.prepareDrawContext();\n    const layer = this.layer;\n\n    if (layer && layer.draw && this.gl) {\n      layer.draw(this.gl);\n    }\n\n    this.completeRender();\n  }\n\n  public _redraw() {\n    this.prepareRender();\n    this.draw();\n  }\n\n  public clearCanvas() {\n    if (this.gl) {\n      // clearScene(this.gl, [0, 0, 0, 0]);\n    }\n  }\n\n  public createContext() {\n    if (this.gl && this.gl.canvas === this.canvas) {\n      return;\n    }\n\n    // @ts-ignore\n    this.gl = getGlContext(this.canvas, this.layer.options.glOptions);\n  }\n\n  public resizeCanvas(canvasSize?: any) {\n    if (this.canvas && this.gl) {\n      const map = this.getMap();\n      const retina = map.getDevicePixelRatio();\n      const size = canvasSize || map.getSize();\n      this.canvas.height = retina * size.height;\n      this.canvas.width = retina * size.width;\n      if (this.gl) {\n        this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n      }\n    }\n  }\n\n  public drawOnInteracting() {\n    this.draw();\n  }\n\n  public onZoomStart(...args: any[]) {\n    super.onZoomStart.apply(this, args);\n  }\n\n  public onZoomEnd(...args: any[]) {\n    super.onZoomEnd.apply(this, args);\n  }\n\n  public onDragRotateStart(...args: any[]) {\n    super.onDragRotateStart.apply(this, args);\n  }\n\n  public onDragRotateEnd(...args: any[]) {\n    super.onDragRotateEnd.apply(this, args);\n  }\n\n  public onMoveStart(...args: any[]) {\n    super.onMoveStart.apply(this, args);\n  }\n\n  public onMoveEnd(...args: any[]) {\n    super.onMoveEnd.apply(this, args);\n  }\n\n  // onResize() {}\n\n  public remove() {\n    delete this._drawContext;\n    super.remove();\n  }\n\n  public getMap() {\n    return super.getMap();\n  }\n\n  public completeRender() {\n    return super.completeRender();\n  }\n\n  private prepareCanvas() {\n    return super.prepareCanvas();\n  }\n\n  private prepareDrawContext() {\n    super.prepareDrawContext();\n  }\n\n  private prepareRender() {\n    return super.prepareRender();\n  }\n}\n\nexport default Renderer;\n","import { CanvasLayer, Coordinate } from 'maptalks';\nimport WindGL from './core/index';\nimport Renderer from './render/renderer';\n\nconst _options = {\n  renderer: 'gl',\n  doubleBuffer: false,\n  animation: true,\n  wrapX: true,\n  glOptions: {\n    antialias: false,\n    depth: false,\n    stencil: false,\n    alpha: true,\n    premultipliedAlpha: true,\n    preserveDrawingBuffer: true,\n  },\n};\n\nclass WindLayer extends CanvasLayer {\n  private datas: {\n    data: {\n      source: string;\n      date: Date;\n      width: number;\n      height: number;\n      uMin: number;\n      uMax: number;\n      vMin: number;\n      vMax: number;\n    },\n    image: any,\n  };\n  private wind: WindGL | null;\n  constructor(id: any, datas: any, options = {}) {\n    super(id, Object.assign(_options, options));\n    this.datas = datas;\n\n    /**\n     * wind instance\n     * @type {null}\n     */\n    this.wind = null;\n  }\n\n  setOptions(options = {}) {\n    this.options = Object.assign(this.options, options);\n    if (this.wind) {\n      this.wind.setOptions(this.options);\n    }\n  }\n\n  /**\n   * get data\n   * @returns {*}\n   */\n  getWindData() {\n    return this.datas;\n  }\n\n  /**\n   * set data\n   * @param datas\n   */\n  setWindData(datas: {\n    data: {\n      source: string;\n      date: Date;\n      width: number;\n      height: number;\n      uMin: number;\n      uMax: number;\n      vMin: number;\n      vMax: number;\n    },\n    image: any,\n  }) {\n    this.datas = datas;\n    if (this.wind) {\n      this.wind.setWind(this.datas.data, this.datas.image);\n    }\n  }\n\n  prepareToDraw() {\n    return [];\n  }\n\n  draw(gl: WebGLRenderingContext) {\n    const map = this.getMap();\n    if (!map) return;\n\n    if (!this.wind) {\n      const { fadeOpacity, speedFactor, dropRate, dropRateBump, colorRamp, numParticles } = this.options;\n      this.wind = new WindGL(gl, {\n        fadeOpacity,\n        speedFactor,\n        dropRate,\n        dropRateBump,\n        colorRamp,\n        numParticles,\n      });\n    }\n\n    if (this.wind) {\n      const scale = map.getResolution(map.getGLZoom());\n      // const proj = map.getSpatialReference().getTransformation().transform([], scale);\n      const proj = map.getSpatialReference().getTransformation();\n      // @tip this.matrix[0] * (coordinates.x - this.matrix[2]) / scale, this.matrix[1] * (coordinates.y - this.matrix[3]) / scale\n\n      const projObject = map.getProjection().fullExtent;\n      const projectionExtent = [\n        projObject.left,\n        projObject.bottom,\n        projObject.right,\n        projObject.top,\n      ];\n      const worlds = this.getWrappedWorlds();\n      // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < worlds.length; i++) {\n        this.wind.render(map.projViewMatrix, worlds[i], {\n          transformMatrix: proj.matrix,\n          transformScale: scale,\n          projectionExtent,\n        });\n      }\n    }\n  }\n\n  public getWrappedWorlds() {\n    const map = this.getMap();\n    const projObject = map.getProjection().fullExtent;\n    const projectionExtent = [\n      projObject.left,\n      projObject.bottom,\n      projObject.right,\n      projObject.top,\n    ];\n    const projExtent = map.getProjExtent();\n    const extent = [\n      projExtent.xmin,\n      projExtent.ymin,\n      projExtent.xmax,\n      projExtent.ymax,\n    ];\n    let startX = extent[0];\n    const worldWidth = projectionExtent[2] - projectionExtent[0];\n    const projWorldWidth = Math.abs(\n      map.coordToPoint(\n        map\n          .getProjection()\n          .unprojectCoords(\n            new Coordinate([projectionExtent[0], projectionExtent[1]]),\n          ),\n        map.getGLZoom(),\n      ).x -\n      map.coordToPoint(\n        map\n          .getProjection()\n          .unprojectCoords(\n            new Coordinate([projectionExtent[2], projectionExtent[3]]),\n          ),\n        map.getGLZoom(),\n      ).x,\n    );\n    let world = 0;\n\n    const result = [];\n\n    if (this.options.wrapX) {\n      while (startX < projectionExtent[0]) {\n        --world;\n        result.push(world * projWorldWidth);\n        startX += worldWidth;\n      }\n      world = 0;\n      startX = extent[2];\n      while (startX > projectionExtent[2]) {\n        ++world;\n        result.push(world * projWorldWidth);\n        startX -= worldWidth;\n      }\n    }\n\n    result.push(0);\n\n    return result;\n  }\n\n  onResize() {\n    super.onResize();\n  }\n\n  remove() {\n    super.remove();\n  }\n\n  getValue(coordinates: any) {\n    if (this.wind && this.wind.framebuffer) {\n      // from: https://github.com/liubgithub/maptalks.wind/blob/master/src/WindLayerRenderer.js#L574\n      const data = this.datas.data;\n      const t = coordinates.x % 180;\n      const pixelX = ((t + 180) / 360) * data.width;\n      if (coordinates.y < -90 || coordinates.y > 90) {\n        throw new Error('Invalid y for coordinate');\n      }\n      const pixelY = ((90 - coordinates.y) / 180) * data.height;\n      // end\n      // const xy = this.map.coordinateToContainerPoint(coordinates);\n      const gl = this.wind.gl;\n      // https://developer.mozilla.org/zh-CN/docs/Web/API/WebGLRenderingContext/pixelStorei\n      gl.pixelStorei(gl.PACK_ALIGNMENT || 0x0D05, 4);\n\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/readPixels\n      const pixels = new Uint8Array(4);\n      gl.readPixels(pixelX, pixelY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n      return pixels;\n    }\n    return null;\n  }\n}\n\nWindLayer.registerRenderer('gl', Renderer);\n\nexport {\n  WindLayer,\n};\n"],"names":["tslib_1.__extends","maptalks.renderer","Coordinate","CanvasLayer"],"mappings":"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"}